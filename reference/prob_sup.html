<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Probabilities of superior performance and stability — prob_sup • ProbBreed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probabilities of superior performance and stability — prob_sup"><meta name="description" content="This function estimates the probabilities of superior performance and stability
across environments, and probabilities of superior performance within environments."><meta property="og:description" content="This function estimates the probabilities of superior performance and stability
across environments, and probabilities of superior performance within environments."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ProbBreed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/saulo-chaves/ProbBreed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Probabilities of superior performance and stability</h1>
      <small class="dont-index">Source: <a href="https://github.com/saulo-chaves/ProbBreed/blob/main/R/prob_sup.R" class="external-link"><code>R/prob_sup.R</code></a></small>
      <div class="d-none name"><code>prob_sup.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function estimates the probabilities of superior performance and stability
across environments, and probabilities of superior performance within environments.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prob_sup</span><span class="op">(</span><span class="va">extr</span>, <span class="va">int</span>, increase <span class="op">=</span> <span class="cn">TRUE</span>, save.df <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-extr">extr<a class="anchor" aria-label="anchor" href="#arg-extr"></a></dt>
<dd><p>An object of class <code>extr</code>, obtained from the <a href="extr_outs.html">extr_outs</a> function</p></dd>


<dt id="arg-int">int<a class="anchor" aria-label="anchor" href="#arg-int"></a></dt>
<dd><p>A numeric representing the selection intensity
(between 0 and 1)</p></dd>


<dt id="arg-increase">increase<a class="anchor" aria-label="anchor" href="#arg-increase"></a></dt>
<dd><p>Logical.<code>TRUE</code> (default) if the selection is for increasing the trait value, <code>FALSE</code> otherwise.</p></dd>


<dt id="arg-save-df">save.df<a class="anchor" aria-label="anchor" href="#arg-save-df"></a></dt>
<dd><p>Logical. Should the data frames be saved in the work directory?
<code>TRUE</code> for saving, <code>FALSE</code> (default) otherwise.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical value. If <code>TRUE</code>, the function will indicate the
completed steps. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns an object of class <code>probsup</code>, which contains two lists,
one with the <code>across</code>-environments probabilities, and another with the <code>within</code>-environments probabilities.
If an entry-mean model was used in <code><a href="bayes_met.html">ProbBreed::bayes_met</a></code>, only the <code>across</code> list will be available.</p>
<p>The <code>across</code> list has the following elements:</p><ul><li><p><code>g_hpd</code>: Highest posterior density (HPD) of the posterior genotypic main effects.</p></li>
<li><p><code>perfo</code>: the probabilities of superior performance.</p></li>
<li><p><code>pair_perfo</code>: the pairwise probabilities of superior performance.</p></li>
<li><p><code>stabi</code>: a list with the probabilities of superior stability. It contains the data frames <code>gl</code>,
<code>gm</code> (when <code>reg</code> is not <code>NULL</code>) and <code>gt</code> (when <code>year</code> is not <code>NULL</code>). Unavailable if an entry-mean model was used in <code>bayes_met</code>.</p></li>
<li><p><code>pair_stabi</code>: a list with the pairwise probabilities of superior stability. It contains the data frames <code>gl</code>,
<code>gm</code> (when <code>reg</code> is not <code>NULL</code>) and <code>gt</code> (when <code>year</code> is not <code>NULL</code>). Unavailable if an entry-mean model was used in <code>bayes_met</code>.</p></li>
<li><p><code>joint_prob</code>: the joint probabilities of superior performance and stability. Unavailable if an entry-mean model was used in <code>bayes_met</code>.</p></li>
</ul><p>The <code>within</code> list has the following elements:</p><ul><li><p><code>perfo</code>: a list of data frames containing the probabilities of superior performance
within locations (<code>gl</code>), regions (<code>gm</code>) and years (<code>gt</code>).</p></li>
<li><p><code>pair_perfo</code>: lists with the pairwise probabilities of superior performance
within locations (<code>gl</code>), regions (<code>gm</code>) and years (<code>gt</code>).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Probabilities provide the risk of recommending a selection candidate for a target
population of environments or for a specific environment. <code>prob_sup</code>
computes the probabilities of superior performance and the probabilities of superior stability:</p>
<ul><li><p>Probability of superior performance</p></li>
</ul><p>Let \(\Omega\) represent the subset of selected genotypes based on their
performance across environments. A given genotype \(j\) will belong to \(\Omega\)
if its genotypic marginal value (\(\hat{g}_j\)) is high or low enough compared to
its peers. <code>prob_sup</code> leverages the Monte Carlo discretized sampling
from the posterior distribution to emulate the occurrence of \(S\) trials. Then,
the probability of the \(j^{th}\) genotype belonging to \(\Omega\) is the
ratio of success (\(\hat{g}_j \in \Omega\)) events and the total number of sampled events,
as follows:</p>
<p>$$Pr\left(\hat{g}_j \in \Omega \vert y \right) = \frac{1}{S}\sum_{s=1}^S{I\left(\hat{g}_j^{(s)} \in \Omega \vert y\right)}$$</p>
<p>where \(S\) is the total number of samples \(\left(s = 1, 2, ..., S \right)\),
and \(I\left(g_j^{(s)} \in \Omega \vert y\right)\) is an indicator variable that can assume
two values: (1) if \(\hat{g}_j^{(s)} \in \Omega\) in the \(s^{th}\) sample,
and (0) otherwise. \(S\) is conditioned to the number of iterations and chains
previously set at <a href="bayes_met.html">bayes_met</a>.</p>
<p>Similarly, the within-environment probability of superior performance can be applied to
individual environments. Let \(\Omega_k\) represent the subset of superior
genotypes in the \(k^{th}\) environment, so that the probability of the
\(j^{th} \in \Omega_k\) can calculated as follows:</p>
<p>$$Pr\left(\hat{g}_{jk} \in \Omega_k \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y\right)$$</p>
<p>where \(I\left(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y\right)\) is an indicator variable
mapping success (1) if \(\hat{g}_{jk}^{(s)}\) exists in \(\Omega_k\), and
failure (0) otherwise, and \(\hat{g}_{jk}^{(s)} = \hat{g}_j^{(s)} + \widehat{ge}_{jk}^{(s)}\).
Note that when computing within-environment probabilities, we are accounting for
the interaction of the \(j^{th}\) genotype with the \(k^{th}\)
environment.</p>
<p>The pairwise probabilities of superior performance can also be calculated across
or within environments. This metric assesses the probability of the \(j^{th}\)
genotype being superior to another experimental genotype or a commercial check.
The calculations are as follows, across and within environments, respectively:</p>
<p>$$Pr\left(\hat{g}_{j} &gt; \hat{g}_{j^\prime} \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{j}^{(s)} &gt; \hat{g}_{j^\prime}^{(s)} \vert y\right)$$</p>
<p>or</p>
<p>$$Pr\left(\hat{g}_{jk} &gt; \hat{g}_{j^\prime k} \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{jk}^{(s)} &gt; \hat{g}_{j^\prime k}^{(s)} \vert y\right)$$</p>
<p>These equations are set for when the selection direction is positive. If
<code>increase = FALSE</code>, \(&gt;\) is simply switched by \(&lt;\).</p>
<ul><li><p>Probability of superior stability</p></li>
</ul><p>This probability makes a direct analogy with the
method of Shukla (1972): a stable genotype is the one that has a low
genotype-by-environment interaction variance \([var(\widehat{ge})]\).
Using the same probability principles previously described, the probability
of superior stability is given as follows:</p>
<p>$$Pr \left[var \left(\widehat{ge}_{jk}\right) \in \Omega \vert y \right] = \frac{1}{S} \sum_{s=1}^S I\left[var \left(\widehat{ge}_{jk}^{(s)} \right) \in \Omega \vert y \right]$$</p>
<p>where \(I\left[var \left(\widehat{ge}_{jk}^{(s)} \right) \in \Omega \vert y \right]\) indicates if
\(var\left(\widehat{ge}_{jk}^{(s)}\right)\) exists in \(\Omega\) (1) or not (0).
Pairwise probabilities of superior stability are also possible in this context:</p>
<p>$$Pr \left[var \left(\widehat{ge}_{jk} \right) &lt; var\left(\widehat{ge}_{j^\prime k} \right) \vert y \right] = \frac{1}{S} \sum_{s=1}^S I \left[var \left(\widehat{ge}_{jk} \right)^{(s)} &lt; var \left(\widehat{ge}_{j^\prime k} \right)^{(s)} \vert y \right]$$</p>
<p>Note that \(j\) will be superior to \(j^\prime\) if it has a <strong>lower</strong>
variance of the genotype-by-environment interaction effect. This is true regardless
if <code>increase</code> is set to <code>TRUE</code> or <code>FALSE</code>.</p>
<p>The joint probability independent events is the product of the individual probabilities.
The estimated genotypic main effects and the variances of GEI effects are independent
by design, thus the joint probability of superior performance and stability as follows:</p>
<p>$$Pr \left[\hat{g}_j \in \Omega \cap var \left(\widehat{ge}_{jk} \right) \in \Omega \right] = Pr \left(\hat{g}_j \in \Omega \right) \times Pr \left[var \left(\widehat{ge}_{jk} \right) \in \Omega \right]$$</p>
<p>The estimation of these probabilities are strictly related to some key questions that
constantly arises in plant breeding:</p><ul><li><p><strong>What is the risk of recommending a selection candidate for a target population of environments?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate having good performance if
recommended to a target population of environments? And for a specific environment?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate having better performance
than a cultivar check in the target population of environments? And in specific environments?</strong></p></li>
<li><p><strong>How probable is it that a given selection candidate performs similarly across environments?</strong></p></li>
<li><p><strong>What are the chances that a given selection candidate is more stable
than a cultivar check in the target population of environments?</strong></p></li>
<li><p><strong>What is the probability that a given selection candidate having a
superior and invariable performance across environments?</strong></p></li>
</ul><p>More details about the usage of <code>prob_sup</code>, as well as the other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/">https://saulo-chaves.github.io/ProbBreed_site/</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Dias, K. O. G, Santos J. P. R., Krause, M. D., Piepho H. -P., Guimarães, L. J. M.,
Pastina, M. M., and Garcia, A. A. F. (2022). Leveraging probability concepts
for cultivar recommendation in multi-environment trials. <em>Theoretical and
Applied Genetics</em>, 133(2):443-455. <a href="https://doi.org/10.1007/s00122-022-04041-y" class="external-link">doi:10.1007/s00122-022-04041-y</a></p>
<p>Shukla, G. K. (1972) Some statistical aspects of partioning genotype environmental
componentes of variability. <em>Heredity</em>, 29:237-245. <a href="https://doi.org/10.1038/hdy.1972.87" class="external-link">doi:10.1038/hdy.1972.87</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="plot.probsup.html">plot.probsup</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">maize</span>,</span></span>
<span class="r-in"><span>                gen <span class="op">=</span> <span class="st">"Hybrid"</span>,</span></span>
<span class="r-in"><span>                loc <span class="op">=</span> <span class="st">"Location"</span>,</span></span>
<span class="r-in"><span>                repl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rep"</span>,<span class="st">"Block"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                trait <span class="op">=</span> <span class="st">"GY"</span>,</span></span>
<span class="r-in"><span>                reg <span class="op">=</span> <span class="st">"Region"</span>,</span></span>
<span class="r-in"><span>                year <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                res.het <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">2</span>, chain <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         292.958 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                561.674 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There were 2 chains where the estimated Bayesian Fraction of Missing Information was low. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bfmi-low</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is 1.18, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">outs</span> <span class="op">=</span> <span class="fu"><a href="extr_outs.html">extr_outs</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>,</span></span>
<span class="r-in"><span>                 probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Posterior effects extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Variances extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Maximum posterior values extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Posterior predictive checks computed</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 of 4000 iterations ended with a divergence.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 of 4000 iterations saturated the maximum tree depth of 10.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> E-BFMI indicated possible pathological behavior:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Chain 2: E-BFMI = 0.161</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Chain 4: E-BFMI = 0.155</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> E-BFMI below 0.2 indicates you may need to reparameterize your model.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">=</span> <span class="fu">prob_sup</span><span class="op">(</span>extr <span class="op">=</span> <span class="va">outs</span>,</span></span>
<span class="r-in"><span>                   int <span class="op">=</span> <span class="fl">.2</span>,</span></span>
<span class="r-in"><span>                   increase <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                   save.df <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Saulo Chaves, Kaio Dias, Matheus Krause.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

